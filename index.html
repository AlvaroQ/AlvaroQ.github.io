<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' 'unsafe-eval' 'wasm-unsafe-eval';
        style-src 'self' 'unsafe-inline';
        img-src 'self' data: https:;
        connect-src 'self' https://portfolio-chatbot.alvaroq-dev.workers.dev;
        font-src 'self';
        object-src 'none';
        frame-ancestors 'none';
        base-uri 'self';
        form-action 'self';
    ">

    <!-- SEO Meta Tags -->
    <title>Alvaro Quintana | Mobile & AI Developer | Kotlin, KMP, AI Agents</title>
    <meta name="description" content="Senior Mobile Developer & AI Specialist. +12 years building Android, iOS, and KMP apps. Expert in Kotlin Multiplatform, Jetpack Compose, and AI Agent Orchestration with Claude, LangChain, MCP.">
    <meta name="keywords" content="Kotlin Developer, Android Developer, KMP, Kotlin Multiplatform, AI Agent, Claude, LangChain, Mobile Developer Madrid, Jetpack Compose">
    <meta name="author" content="Alvaro Quintana">
    <meta name="robots" content="index, follow">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Alvaro Quintana | Mobile & AI Developer">
    <meta property="og:description" content="Senior Mobile Developer & AI Specialist. Expert in Kotlin Multiplatform and AI Agent Orchestration.">
    <meta property="og:url" content="https://alvaroquintana.dev/">
    <meta property="og:site_name" content="Alvaro Quintana Portfolio">
    <meta property="og:locale" content="es_ES">
    <meta property="og:locale:alternate" content="en_US">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Alvaro Quintana | Mobile & AI Developer">
    <meta name="twitter:description" content="Senior Mobile Developer & AI Specialist. Expert in KMP and AI Agents.">

    <!-- Favicon & PWA -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="favicon.svg">
    <meta name="theme-color" content="#00FFFF">

    <!-- Language Alternates -->
    <link rel="alternate" hreflang="es" href="https://alvaroquintana.dev/?lang=es">
    <link rel="alternate" hreflang="en" href="https://alvaroquintana.dev/?lang=en">
    <link rel="alternate" hreflang="x-default" href="https://alvaroquintana.dev/">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://alvaroquintana.dev/">
    <style>
        /* CSS Variables for theming */
        :root {
            --bg-color: #0A0A0F;
            --banner-bg: linear-gradient(90deg, rgba(10, 10, 15, 0.98) 0%, rgba(25, 25, 35, 0.98) 50%, rgba(10, 10, 15, 0.98) 100%);
            --banner-border: rgba(0, 255, 255, 0.4);
            --text-color: #E0E0E0;
            --accent-color: #00FFFF;
        }

        [data-theme="light"] {
            --bg-color: #F0F0F8;
            --banner-bg: linear-gradient(90deg, rgba(240, 240, 248, 0.98) 0%, rgba(232, 232, 240, 0.98) 50%, rgba(240, 240, 248, 0.98) 100%);
            --banner-border: rgba(0, 184, 184, 0.6);
            --text-color: #1A1A2E;
            --accent-color: #00B8B8;
        }

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: var(--bg-color);
            transition: background 0.3s ease;
        }

        #ComposeTarget {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            width: 100% !important;
            height: 100% !important;
        }

        /* Loading indicator */
        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9998;
            font-family: 'JetBrains Mono', 'Fira Code', Consolas, monospace;
            transition: opacity 0.5s ease;
        }

        #loadingOverlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(0, 255, 255, 0.2);
            border-top-color: #00FFFF;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 20px;
            color: var(--text-color);
            font-size: 14px;
            letter-spacing: 2px;
        }

        .loading-subtext {
            margin-top: 8px;
            color: rgba(224, 224, 224, 0.5);
            font-size: 11px;
        }

        /* Browser compatibility warning */
        #browserWarning {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(10, 10, 15, 0.98);
            border: 1px solid #FF8000;
            border-radius: 12px;
            padding: 32px;
            text-align: center;
            font-family: 'JetBrains Mono', Consolas, monospace;
            color: #E0E0E0;
            z-index: 10000;
            max-width: 420px;
        }

        #browserWarning h2 {
            color: #FF8000;
            margin: 0 0 16px;
            font-size: 18px;
        }

        #browserWarning p {
            margin: 0 0 12px;
            line-height: 1.6;
            font-size: 13px;
        }

        #browserWarning .browsers {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-top: 20px;
        }

        #browserWarning .browsers a {
            color: #00FFFF;
            text-decoration: none;
            padding: 8px 16px;
            border: 1px solid #00FFFF;
            border-radius: 6px;
            font-size: 12px;
            transition: background 0.2s;
        }

        #browserWarning .browsers a:hover {
            background: rgba(0, 255, 255, 0.1);
        }
    </style>
</head>
<body>
    <!-- Loading overlay -->
    <div id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">INITIALIZING...</div>
        <div class="loading-subtext">Loading WebAssembly module</div>
    </div>

    <!-- Browser compatibility warning (hidden by default) -->
    <div id="browserWarning">
        <h2>[ BROWSER NOT SUPPORTED ]</h2>
        <p>This portfolio uses WebAssembly technology that your browser doesn't fully support.</p>
        <p>Please use a modern browser:</p>
        <div class="browsers">
            <a href="https://www.google.com/chrome/" target="_blank">Chrome</a>
            <a href="https://www.mozilla.org/firefox/" target="_blank">Firefox</a>
            <a href="https://www.microsoft.com/edge" target="_blank">Edge</a>
        </div>
    </div>

    <canvas id="ComposeTarget"></canvas>
    <script>
        // Check WebAssembly support
        (function() {
            var wasmSupported = typeof WebAssembly === 'object' &&
                typeof WebAssembly.instantiate === 'function' &&
                typeof WebAssembly.compile === 'function';

            if (!wasmSupported) {
                console.error('[WASM] WebAssembly not supported in this browser');
                document.getElementById('loadingOverlay').style.display = 'none';
                document.getElementById('browserWarning').style.display = 'block';
                return;
            }
            console.log('[WASM] WebAssembly supported');
        })();

        // Hide loading overlay when WASM app starts rendering
        window.hideLoadingOverlay = function() {
            var overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.classList.add('hidden');
                setTimeout(function() {
                    overlay.style.display = 'none';
                }, 500);
            }
        };

        // Auto-hide loading after WASM initializes (fallback timeout)
        // 45 seconds to accommodate slow connections loading ~11MB of WASM
        var loadingTimeout = setTimeout(function() {
            var overlay = document.getElementById('loadingOverlay');
            if (overlay && !overlay.classList.contains('hidden')) {
                console.warn('[WASM] Loading timeout - hiding overlay anyway');
                window.hideLoadingOverlay();
            }
        }, 45000); // 45 second timeout for slow connections

        // Global error handling for WASM
        window.onerror = function(message, source, lineno, colno, error) {
            console.error('[WASM Error]', message, source, lineno, colno);
            clearTimeout(loadingTimeout);

            // Hide loading overlay
            var loadingOverlay = document.getElementById('loadingOverlay');
            if (loadingOverlay) loadingOverlay.style.display = 'none';

            // Show user-friendly error message
            if (!document.getElementById('errorOverlay')) {
                var overlay = document.createElement('div');
                overlay.id = 'errorOverlay';
                overlay.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);' +
                    'background:rgba(10,10,15,0.95);border:1px solid #FF0080;border-radius:12px;' +
                    'padding:32px;text-align:center;font-family:monospace;color:#E0E0E0;z-index:9999;max-width:400px;';
                overlay.innerHTML = '<h2 style="color:#FF0080;margin:0 0 16px">[ SYSTEM ERROR ]</h2>' +
                    '<p>An unexpected error occurred. Please try:</p>' +
                    '<ul style="text-align:left;margin:12px 0;font-size:13px;line-height:1.8;">' +
                    '<li>Refresh the page (Ctrl+Shift+R)</li>' +
                    '<li>Clear browser cache</li>' +
                    '<li>Use Chrome, Firefox, or Edge</li></ul>' +
                    '<button onclick="location.reload(true)" style="margin-top:16px;padding:12px 24px;' +
                    'background:transparent;border:1px solid #00FFFF;color:#00FFFF;cursor:pointer;' +
                    'border-radius:8px;font-family:monospace;font-weight:bold;">[ RELOAD ]</button>';
                document.body.appendChild(overlay);
            }
            return false;
        };

        // Unhandled promise rejections
        window.addEventListener('unhandledrejection', function(event) {
            console.error('[WASM Promise Rejection]', event.reason);
        });

        // Initialize theme from localStorage
        (function() {
            var savedTheme = localStorage.getItem('portfolio_theme') || 'dark';
            if (savedTheme === 'light') {
                document.documentElement.setAttribute('data-theme', 'light');
            }
        })();

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                // Use relative path for subdirectory compatibility
                navigator.serviceWorker.register('./sw.js')
                    .then(function(registration) {
                        console.log('[PWA] Service Worker registered:', registration.scope);
                        // Check for updates
                        registration.update();
                    })
                    .catch(function(error) {
                        console.log('[PWA] Service Worker registration failed:', error);
                    });
            });
        }
    </script>
    <script type="application/javascript" src="composeApp.js"></script>

    <!-- Chat Widget -->
    <script src="chat-widget.js"></script>
    <script>
        // Initialize chat widget after DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            var savedTheme = localStorage.getItem('portfolio_theme') || 'dark';
            var savedLang = localStorage.getItem('portfolio_lang') || 'es';

            window.chatWidget = new PortfolioChatWidget({
                theme: savedTheme,
                lang: savedLang
            });

            // Auto-open chat if URL contains #chat
            if (window.location.hash === '#chat') {
                setTimeout(function() {
                    window.openChatWidget();
                }, 500);
            }
        });

        // Expose functions for Kotlin interop to sync theme/lang
        window.updateChatWidgetTheme = function(theme) {
            if (window.chatWidget) {
                window.chatWidget.setTheme(theme);
            }
        };
        window.updateChatWidgetLang = function(lang) {
            if (window.chatWidget) {
                window.chatWidget.setLang(lang);
            }
        };
    </script>

    <!-- Project Detail Modal -->
    <script src="project-modal.js"></script>
    <script>
        // Initialize project modal with saved theme/lang
        document.addEventListener('DOMContentLoaded', function() {
            var savedTheme = localStorage.getItem('portfolio_theme') || 'dark';
            var savedLang = localStorage.getItem('portfolio_lang') || 'es';

            if (window.projectModal) {
                window.projectModal.setTheme(savedTheme);
                window.projectModal.setLang(savedLang);
            }
        });
    </script>
</body>
</html>
